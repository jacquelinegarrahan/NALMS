#!/usr/bin/env bash
#
# Author: Jacqueline Garrahan
# Run phoebus-alarm-server image for given configuration
usage() {
  cli_name=${0##*/}
  echo "Usage: nalms start-alarm-server config_name config_file"
  exit 0
}

if [[ "$1" == "-h" ]]; then
  usage
fi

if [[ -z "$1" ]]; then
  usage
else
  CONFIG_NAME="$1"
fi

if [[ -z "$2" ]]; then
  usage
else
  CONFIG_FILE="$2"
fi


if [[ -z "$NALMS_KAFKA_BOOTSTRAP" ]]; then
  echo "No property file provided for logging."
  usage
fi

            KAFKA_BOOTSTRAP: kafka:9092
            EPICS_CA_ADDR_LIST: alarm-ioc example-ioc
            ALARM_IOC: "true"

docker run -v $CONFIG_FILE:/tmp/nalms/$CONFIG_NAME.xml \
  --name nalms_logger_$CONFIG_NAME \
  -e ALARM_IOC=true \
  -e KAFKA_BOOTSTRAP=$KAFKA_BOOTSTRAP \
  -e EPICS_CA_ADDR_LIST=$EPICS_CA_ADDR_LIST \
  -e EPICS_CA_SERVER_PORT=$EPICS_CA_SERVER_PORT \
  -e EPICS_CA_REPEATER_PORT=$EPICS_CA_REPEATER_PORT \
  -e EPICS_CA_ADDR_LIST=$EPICS_PVA_ADDR_LIST \
  -e EPICS_CA_SERVER_PORT=$EPICS_PVA_SERVER_PORT \
  -e EPICS_CA_REPEATER_PORT=$EPICS_PVA_REPEATER_PORT \
  -d -t phoebus-alarm-server start-server $CONFIG_NAME /tmp/nalms/$CONFIG_NAME.xml

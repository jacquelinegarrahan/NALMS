#!/usr/bin/env bash
#
# Author: Jacqueline Garrahan
# Run grafana instance

usage() {
  cli_name=${0##*/}
  echo "Usage: nalms start-grafana [--port grafana_port] [--config config_name]"
  echo "Requires definition of \$NALMS_GRAFANA_PORT, \$NALMS_CONFIGURATIONS, \$NALMS_ES_HOST, \$NALMS_ES_PORT"
  exit 0
}

# parse optional items
while test $# -gt 0
do
    case "$1" in
        --port) 
          NALMS_GRAFANA_PORT=$2
            ;;
        --config) 
          NALMS_CONFIGURATIONS=$2
            ;;
        "")
    esac
    shift
done

if [[ -z "$NALMS_GRAFANA_PORT" ]]; then
  echo "No port provided for Grafana."
  usage
fi

if [[ -z "$NALMS_CONFIGURATIONS" ]]; then
  echo "No configurations provided to launch Grafana."
  usage
fi

if [[ -z "$NALMS_ES_HOST" ]]; then
  echo "Elasticsearch host not defined."
  usage
fi


if [[ -z "$NALMS_ES_PORT" ]]; then
  echo "Elasticsearch port not defined."
  usage
fi

docker run \
    -p "$NALMS_GRAFANA_PORT:3000" \
    -e ES_HOST=$NALMS_ES_HOST \
    -e ES_PORT=$NALMS_ES_PORT \
    -e CONFIG_NAME=$NALMS_CONFIGURATIONS \
    --name nalms_grafana \
    -d jgarrahan/nalms-grafana:latest


#!/usr/bin/env bash
#
# Author: Jacqueline Garrahan
# Run cruise-control image and serve UI
#
usage() {
  cli_name=${0##*/}
  echo "Usage: nalms start-cruise-control [--properties property_file]"
  exit 0
}

if [[ "$1" == "-h" ]]; then
  usage
fi

# parse optional items
while test $# -gt 0
do
    case "$1" in
        --properties) 
          $NALMS_CRUISE_CONTROL_PROPERTIES=$2
            ;;
        "")
    esac
    shift
done

if [[ -z "$NALMS_CRUISE_CONTROL_PROPERTIES" ]]; then
  echo "No property file provided for cruise control."
  usage
fi

docker run -v "$NALMS_CRUISE_CONTROL_PROPERTIES:/opt/cruise-control/config/cruisecontrol.properties" \
    -e BOOTSTRAP_SERVERS=$NALMS_KAFKA_BOOTSTRAP \
    -e ZOOKEEPER_CONNECT=$NALMS_ZOOKEEPER_HOST:$NALMS_ZOOKEEPER_PORT \
    -p "$NALMS_CRUISE_CONTROL_PORT:9090" -d cruise-control